(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-66907dfc"],{"03d4":function(e,t,a){"use strict";a("4df7")},1786:function(e,t,a){"use strict";a("ff25")},"4df7":function(e,t,a){},"4ec3":function(e,t,a){"use strict";a.d(t,"i",(function(){return o})),a.d(t,"h",(function(){return r})),a.d(t,"e",(function(){return l})),a.d(t,"b",(function(){return c})),a.d(t,"d",(function(){return d})),a.d(t,"a",(function(){return u}));var n=a("bc3a"),s=a.n(n);s.a.defaults.withCredentials=!0;var i="http://127.0.0.1:5001",o="http://127.0.0.1:5001",r=function(e){return s.a.post("".concat(i,"/login/userLogin"),e).then((function(e){return e.data}))},l=function(e,t){return s.a.get("".concat(i,"/api/campaigns"),{params:t,headers:e}).then((function(e){return e.data}))},c=function(e,t){return s.a.post("".concat(i,"/api/campaigns/add_campaign"),t,{headers:e}).then((function(e){return e.data}))},d=function(e,t){return s.a.get("".concat(i,"/api/campaigns/abexps"),{params:t,headers:e}).then((function(e){return e.data}))},u=function(e,t){return s.a.post("".concat(i,"/api/campaigns/add_ab_exp"),t,{headers:e}).then((function(e){return e.data}))}},8872:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{margin:"30px"}},[a("el-divider"),a("el-descriptions",{staticClass:"margin-top",attrs:{title:"实验基础信息",column:3,size:e.size}},[a("template",{slot:"extra"},[a("router-link",{staticStyle:{"text-decoration":"none",color:"aliceblue"},attrs:{to:{name:"活动管理",params:{campaign_id:this.$route.params.campaign_id}},align:"right"}},[a("el-button",{},[a("i",{staticClass:"el-icon-arrow-left",staticStyle:{"margin-right":"10px"}}),e._v("返回活动管理")])],1)],1),a("el-descriptions-item",{attrs:{label:"实验名称"}},[e._v(e._s(e.abMetaData.name))]),a("el-descriptions-item",{attrs:{label:"实验类型"}},[a("el-tag",{attrs:{size:"small",type:"primary"}},[e._v(e._s(e.abMetaData.app_type))])],1),a("el-descriptions-item",{attrs:{label:"创建于"}},[a("timeago",{attrs:{datetime:e.abMetaData.creation_date,locale:"zh-CN"}})],1),a("el-descriptions-item",{attrs:{label:"实验描述"}},[e._v(e._s(e.abMetaData.description))])],2),a("el-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[a("el-collapse-item",{attrs:{title:"实验组创建及策略配置",name:"1"}},[a("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"10px"},attrs:{span:24}},[a("el-button",{staticClass:"return-list1",staticStyle:{"margin-left":"15px","margin-right":"10px"},attrs:{type:"primary"},nativeOn:{click:function(t){return e.addNewExp.apply(null,arguments)}}},[a("i",{staticClass:"el-icon-plus",staticStyle:{"margin-right":"5px","margin-left":"0px"}}),e._v("保存")]),a("router-link",{staticStyle:{"text-decoration":"none",color:"aliceblue"},attrs:{to:{name:"活动管理",params:{campaign_id:this.$route.params.campaign_id}},align:"right"}},[a("el-button",{staticClass:"return-list1"},[e._v("取消")])],1)],1),a("el-col",{attrs:{span:24}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.FormRules}},[a("div",{staticStyle:{border:"1px solid #e6e6e6","margin-bottom":"10px",padding:"15px"}},[a("p",{staticStyle:{"margin-bottom":"0"}},[e._v("测试您的产品的多种变化。")]),a("p",[e._v(" 注意：确保你的曝光率加起来是100%，并且你选择了一个基本的变体（出错的时候会统统发送给它）。")]),a("br"),a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:22}},[a("el-table",{ref:"multipleHeadTable",attrs:{data:e.form.modelData,"highlight-current-row":""},on:{"selection-change":e.selsExp}},[a("el-table-column",{attrs:{"label-class-name":"出错时将只向选择实例发送请求","render-header":e.openAnnotation,type:"selection","min-width":"5%",label:"默认"}}),a("el-table-column",{attrs:{prop:"altName",label:"实验组","min-width":"20%","label-class-name":"曝光的实验实例名称","render-header":e.openAnnotation},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{value:t.row.altName,placeholder:"请输入实验组名称"},model:{value:t.row.altName,callback:function(a){e.$set(t.row,"altName","string"===typeof a?a.trim():a)},expression:"scope.row.altName"}})]}}])}),a("el-table-column",{attrs:{prop:"altName",label:"实验组描述","min-width":"30%","label-class-name":"实验组描述","render-header":e.openAnnotation},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{value:t.row.description,placeholder:"请输入实验组描述"},model:{value:t.row.description,callback:function(a){e.$set(t.row,"description","string"===typeof a?a.trim():a)},expression:"scope.row.description"}})]}}])}),a("el-table-column",{attrs:{prop:"exposureNum",label:"流量分配(%)","min-width":"10%","label-class-name":"各实例曝光比例","render-header":e.openAnnotation},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{placeholder:"请输入流量比率"},model:{value:t.row.exposureNum,callback:function(a){e.$set(t.row,"exposureNum",a)},expression:"scope.row.exposureNum"}})]}}])}),a("el-table-column",{attrs:{prop:"modelname",label:"策略配置","min-width":"20%","label-class-name":"可以从策略库挑选或单独创建","render-header":e.openAnnotation},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{value:t.row.modelname,placeholder:"请输入策略"},model:{value:t.row.modelname,callback:function(a){e.$set(t.row,"modelname","string"===typeof a?a.trim():a)},expression:"scope.row.modelname"}})]}}])}),a("el-table-column",{attrs:{label:"","min-width":"10%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("i",{staticClass:"el-icon-delete",staticStyle:{"font-size":"30px",cursor:"pointer"},on:{click:function(a){return e.delModelHead(t.$index)}}})]}}])}),a("el-table-column",{staticStyle:{"margin-right":"6px"},attrs:{label:"","min-width":"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.$index===e.form.modelData.length-1?a("el-button",{staticClass:"el-icon-plus",attrs:{size:"mini"},on:{click:e.addModelHead}}):e._e()]}}])})],1)],1)],1),a("br"),a("el-row",{directives:[{name:"show",rawName:"v-show",value:"普通实验"!=e.abMetaData.app_type,expression:"abMetaData.app_type!='普通实验'"}],attrs:{gutter:10}},[a("h4",{staticStyle:{"padding-left":"8px"}},[e._v("请选择策略库的策略")]),a("br"),a("el-col",{attrs:{span:6}},[a("div",{staticStyle:{height:"400px","line-height":"100px",overflow:"auto","overflow-x":"hidden",border:"1px solid #e6e6e6"}},[a("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"active-text-color":"rgb(32, 160, 255)","unique-opened":!0},on:{select:e.handleSelect}},[a("el-menu-item",{attrs:{index:"-1"},nativeOn:{click:function(t){return e.getModelList()}}},[a("i",{staticClass:"el-icon-menu"}),e._v("所有策略")]),e._l(e.ModelProjects,(function(t,n){return[a("el-menu-item",{key:t.id,staticClass:"group",attrs:{index:n+""},nativeOn:{click:function(a){return e.getModelList(t.id)}}},[a("template",{slot:"title"},[e._v(e._s(t.name)+"\n                                ")])],2)]}))],2)],1)]),a("el-col",{attrs:{span:18}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.apiListLoading,expression:"apiListLoading"}],staticStyle:{width:"100%"},attrs:{data:e.searchApiList,"highlight-current-row":"","show-header":!0,"max-height":"400"},on:{"selection-change":e.selsChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{prop:"modelname",label:"策略名称","min-width":"15%",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                            "+e._s(t.row.model.name)+"\n                        ")]}}])}),a("el-table-column",{attrs:{prop:"description",label:"策略描述","min-width":"25%",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                            "+e._s(t.row.model.description)+"\n                        ")]}}])}),a("el-table-column",{attrs:{prop:"status",label:"策略状态","min-width":"25%",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{directives:[{name:"show",rawName:"v-show",value:"ok"===e.instance_status&&e.instance_id===t.row.id,expression:"instance_status==='ok'&&instance_id===scope.row.id"}],staticStyle:{padding:"2px 4px",color:"#fff","background-color":"#4BB74B"}},[e._v("已上线")]),a("span",{directives:[{name:"show",rawName:"v-show",value:"failed"===e.instance_status&&e.instance_id===t.row.id,expression:"instance_status==='failed'&&instance_id===scope.row.id"}],staticStyle:{padding:"2px 4px",color:"#fff","background-color":"#C0C0C0"}},[e._v("未上线")]),a("el-button",{staticStyle:{"margin-left":"5px"},attrs:{type:"text",size:"medium"},on:{click:function(a){return e.handleModelTest(t.row)}}},[e._v("测试")])]}}])})],1)],1)],1),a("el-row",{directives:[{name:"show",rawName:"v-show",value:"普通实验"!=e.abMetaData.app_type,expression:"abMetaData.app_type!='普通实验'"}]},[a("el-col",{staticClass:"toolbar",attrs:{span:24}},[a("el-pagination",{staticStyle:{float:"right"},attrs:{layout:"prev, pager, next","page-size":10,"page-count":e.total},on:{"current-change":e.handleCurrentChangeApi}})],1)],1)],1)])],1)],1)],1)],1)},s=[],i=(a("4f7f"),a("5df3"),a("1c4c"),a("7f7f"),a("ac6a"),a("c5f6"),a("4ec3")),o=a("1157"),r=a.n(o),l={data:function(){return{baseExpSelected:[],mlexp:!1,gexp:!1,abMetaData:{},activeNames:["1"],ModelProjects:[],instance_status:"failed",instance_id:0,apiListLoading:!1,activeIndex:"",searchApiList:[],page:1,total:0,sels:[],form:{abname:"",description:"",modelData:[{altName:"",description:"",modelname:"No Strategy",exposureNum:50}]},FormRules:{modelname:[{required:!0,message:"请输入实验用例名称",trigger:"blur"}],altlist:[{required:!0,message:"请输入待测试的模型列表",trigger:"blur"}]}}},methods:{getAbMetaData:function(){this.listLoading=!0;var e=this;r.a.ajax({type:"get",url:i["i"]+"/api/campaigns/get_abexp_metadata",async:!0,data:{ab_id:this.$route.params.ab_id},headers:{Authorization:"Token "+JSON.parse(sessionStorage.getItem("token"))},timeout:5e3,success:function(t){e.listLoading=!1,"999999"===t.code?e.abMetaData=t.data.data:e.$message.error({message:t.msg,center:!0})}})},addModelHead:function(){var e={modelname:"No Strategy",description:"",exposureNum:50,altName:"alt_name"};this.form.modelData.push(e)},delModelHead:function(e){1!==this.form.modelData.length&&this.form.modelData.splice(e,1)},handleSelect:function(e,t){this.activeIndex=e,console.log(this.activeIndex)},handleCurrentChangeApi:function(e){this.activeIndex["id"],this.page=e,this.getModelList()},selsExp:function(e){this.baseExpSelected=e},getModelsGroup:function(){var e=this;r.a.ajax({type:"get",url:i["i"]+"/api/models/project_group",async:!0,data:{ab_id:this.$route.params.ab_id},headers:{Authorization:"Token "+JSON.parse(sessionStorage.getItem("token"))},timeout:5e3,success:function(t){"999999"===t.code?(e.ModelProjects=t.data.data,console.log(e.ModelProjects,"self.ModelProjects")):e.$message.error({message:t.msg,center:!0})}})},handleModelTest:function(e){this.apiListLoading=!0;var t=this,a=JSON.stringify({ab_id:Number(this.$route.params.ab_id),ins_id:e.id});console.log(a,"ins_is"),r.a.ajax({type:"post",url:i["i"]+"/api/models/api_status_test",async:!0,data:a,headers:{"Content-Type":"application/json",Authorization:"Token "+JSON.parse(sessionStorage.getItem("token"))},timeout:5e3,success:function(e){t.apiListLoading=!1,"999999"===e.code?(t.instance_status=e.data.data.status,t.instance_id=e.data.data.instance_id,console.log(t.instance_status,"self.instance_status")):t.$message.error({message:e.msg,center:!0})}})},getModelList:function(e){this.apiListLoading=!0;var t=this,a={ab_id:Number(this.$route.params.ab_id),page:t.page};e&&(a["model_project_id"]=Number(e)),r.a.ajax({type:"get",url:i["i"]+"/api/models/api_list",async:!0,data:a,headers:{Authorization:"Token "+JSON.parse(sessionStorage.getItem("token"))},timeout:5e3,success:function(e){t.apiListLoading=!1,"999999"===e.code?(t.searchApiList=e.data.data,t.total=e.data.total,console.log(t.searchApiList,"searchApiList")):t.$message.error({message:e.msg,center:!0})}})},handleCurrentChange:function(e){this.currentRow=e},selsChange:function(e){var t=this;this.sels=e,1===e.length&&""===this.form.modelData[0].altName&&this.form.modelData.splice(0,1),e.forEach((function(e){var a=e;a.exposureNum=50,a.altName=e.name,a.modelname=e.model.name,console.log(a,"ddddddddd"),t.form.modelData.push(a),t.form.modelData=Array.from(new Set(t.form.modelData))}))},addNewExp:function(){var e=this;this.$refs.form.validate((function(t){if(t){var a=e;e.$confirm("确认提交实验吗？","提示",{}).then((function(){var e=JSON.stringify({ab_id:Number(a.$route.params.ab_id),expRegData:a.form.modelData});console.log(e,"param"),r.a.ajax({type:"post",url:i["i"]+"/api/campaigns/add_exp_alt",async:!0,data:e,headers:{"Content-Type":"application/json",Authorization:"Token "+JSON.parse(sessionStorage.getItem("token"))},timeout:5e3,success:function(e){"999999"===e.code?(a.$router.push({name:"实验组信息",params:{ab_id:a.$route.params.ab_id,campaign_id:a.$route.params.campaign_id}}),a.$message({message:"保存成功",center:!0,type:"success"})):a.$message.error({message:e.msg,center:!0})}})})).catch((function(){}))}}))},handleChange:function(e){},openAnnotation:function(e,t){var a=t.column;t.$index;return e("el-tooltip",{class:"item",attrs:{effect:"dark",content:a.labelClassName,placement:"top"}},[e("span",[a.label])])}},watch:{form:{deep:!0}},computed:{},mounted:function(){this.getAbMetaData(),this.getModelsGroup(),this.getModelList()}},c=l,d=(a("03d4"),a("1786"),a("2877")),u=Object(d["a"])(c,n,s,!1,null,"0133f52c",null);t["default"]=u.exports},ff25:function(e,t,a){}}]);
//# sourceMappingURL=chunk-66907dfc.cbbe4714.js.map